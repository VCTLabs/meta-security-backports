From 0053df479b0c8a3f27df38295610731fd4c73e08 Mon Sep 17 00:00:00 2001
From: Steve Arnold <sarnold@vctlabs.com>
Date: Sat, 17 Feb 2024 19:18:37 -0800
Subject: [PATCH 5/6] scap-security-guide: add Petalinux support

Signed-off-by: Steve Arnold <sarnold@vctlabs.com>
---
 products/openembedded/product.yml             |  7 +++-
 .../checks/oval/installed_OS_is_petalinux.xml | 33 +++++++++++++++++++
 2 files changed, 39 insertions(+), 1 deletion(-)
 create mode 100644 shared/checks/oval/installed_OS_is_petalinux.xml

diff --git a/products/openembedded/product.yml b/products/openembedded/product.yml
index 1a7b4a0ec4..fc908ee89d 100644
--- a/products/openembedded/product.yml
+++ b/products/openembedded/product.yml
@@ -1,5 +1,5 @@
 product: openembedded
-full_name: OpenEmbedded 
+full_name: OpenEmbedded
 type: platform
 
 benchmark_id: OPENEMBEDDED
@@ -22,3 +22,8 @@ cpes:
       name: "cpe:/o:openembedded:poky:"
       title: "OpenEmbedded Poky reference distribution"
       check_id: installed_OS_is_poky
+
+  - petalinux:
+      name: "cpe:/o:openembedded:petalinux:"
+      title: "OpenEmbedded petalinux distribution"
+      check_id: installed_OS_is_petalinux
diff --git a/shared/checks/oval/installed_OS_is_petalinux.xml b/shared/checks/oval/installed_OS_is_petalinux.xml
new file mode 100644
index 0000000000..ccb03c36ce
--- /dev/null
+++ b/shared/checks/oval/installed_OS_is_petalinux.xml
@@ -0,0 +1,33 @@
+<def-group>
+  <definition class="inventory" id="installed_OS_is_petalinux" version="1">
+    <metadata>
+      <title>Petalinux</title>
+      <affected family="unix">
+        <platform>multi_platform_all</platform>
+      </affected>
+      <description>The operating system installed is a Petalinux based System</description>
+    </metadata>
+    <criteria comment="System is Petalinux based distribution" operator="AND">
+      <extend_definition comment="Installed OS is part of the Unix family" definition_ref="installed_OS_is_part_of_Unix_family" />
+      <criterion comment="Petalinux based distro" test_ref="test_os_petalinux" />
+      <criterion comment="Petalinux based distribution is installed" test_ref="test_petalinux" />
+    </criteria>
+  </definition>
+
+  <unix:file_test check="all" check_existence="all_exist" comment="/etc/os-release exists" id="test_os_petalinux" version="1">
+    <unix:object object_ref="obj_os_petalinux" />
+  </unix:file_test>
+  <unix:file_object comment="check /etc/os-release file" id="obj_os_petalinux" version="1">
+    <unix:filepath>/etc/os-release</unix:filepath>
+  </unix:file_object>
+
+  <ind:textfilecontent54_test check="all" check_existence="at_least_one_exists" comment="Check OpenEmbedded" id="test_petalinux" version="1">
+    <ind:object object_ref="obj_petalinux" />
+  </ind:textfilecontent54_test>
+  <ind:textfilecontent54_object id="obj_petalinux" version="1" comment="Check Petalinux">
+    <ind:filepath>/etc/os-release</ind:filepath>
+    <ind:pattern operation="pattern match">^ID=&quot;petalinux&quot;$</ind:pattern>
+    <ind:instance datatype="int">1</ind:instance>
+  </ind:textfilecontent54_object>
+
+</def-group>
-- 
2.43.0

